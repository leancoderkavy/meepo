# ── Meepo Configuration ──────────────────────────────────────────
# Location: ~/.meepo/config.toml
# Env vars: ${VAR_NAME} expanded at load time  |  Paths: ~/ for home


# ── Agent ────────────────────────────────────────────────────────

[agent]
default_model = "claude-opus-4-6"       # or claude-sonnet-4-5-20250929
max_tokens = 8192
system_prompt_file = "SOUL.md"          # in workspace dir
memory_file = "MEMORY.md"


# ── Anthropic (required) ────────────────────────────────────────
# Get key → https://console.anthropic.com/settings/keys
# export ANTHROPIC_API_KEY="sk-ant-..."

[providers.anthropic]
api_key = "${ANTHROPIC_API_KEY}"
base_url = "https://api.anthropic.com"

# ── Tavily (optional — web search) ──────────────────────────────
# Get key → https://app.tavily.com/home  (free tier, no card)
# export TAVILY_API_KEY="tvly-..."

[providers.tavily]
api_key = "${TAVILY_API_KEY}"


# ── Discord ──────────────────────────────────────────────────────
# 1. https://discord.com/developers/applications → New App → Bot → Reset Token
# 2. Enable MESSAGE CONTENT INTENT
# 3. OAuth2 → scope: bot → Send Messages → invite to server
# export DISCORD_BOT_TOKEN="..."

[channels.discord]
enabled = false
token = "${DISCORD_BOT_TOKEN}"
allowed_users = []                      # e.g. ["123456789012345678"]

# ── Slack ────────────────────────────────────────────────────────
# 1. https://api.slack.com/apps → Create New App → From scratch
# 2. OAuth & Permissions → scopes: chat:write, channels:read, im:history, im:read, users:read
# 3. Install to Workspace → copy Bot User OAuth Token
# export SLACK_BOT_TOKEN="xoxb-..."

[channels.slack]
enabled = false
bot_token = "${SLACK_BOT_TOKEN}"
poll_interval_secs = 3


# ── iMessage Channel (macOS only) ─────────────────────────────────
# Talk to Meepo via iMessage. No API key needed — uses macOS directly.
#
# Requirements:
#   - macOS with Messages app signed into iMessage
#   - Full Disk Access for your terminal app:
#     System Settings → Privacy & Security → Full Disk Access → add Terminal/iTerm
#
# How it works:
#   - Meepo reads ~/Library/Messages/chat.db (read-only) for incoming messages
#   - Processes all messages from allowed contacts
#   - Sends replies via AppleScript through Messages.app
#
# NOTE: This channel is not available on Windows.

[channels.imessage]
enabled = false
poll_interval_secs = 3
trigger_prefix = "/d"
allowed_contacts = []                   # e.g. ["+15551234567", "me@icloud.com"]

# ── Email Channel (macOS only) ──────────────────────────────────
# Talk to Meepo via email through Mail.app. Works with any email
# account configured in Mail.app (Gmail, iCloud, etc.).
#
# How it works:
#   - Meepo polls Mail.app for unread emails with the subject prefix
#   - Only emails whose subject starts with the prefix are processed
#   - Replies are sent as threaded replies to the original email
#
# Requirements:
#   - macOS Mail.app with at least one email account configured
#   - Automation permissions for your terminal app:
#     System Settings → Privacy & Security → Automation → Terminal → Mail
#
# NOTE: This channel is not available on Windows.
# On Windows, use the read_emails/send_email tools which use Outlook via PowerShell.
#
# Example: Send an email with subject "[meepo] What's on my calendar?"

[channels.email]
enabled = false                          # Set to true to enable
poll_interval_secs = 10                  # How often to check for new emails
subject_prefix = "[meepo]"              # Emails must have this subject prefix


# ── Knowledge Graph ──────────────────────────────────────────────

[knowledge]
db_path = "~/.meepo/knowledge.db"
tantivy_path = "~/.meepo/tantivy_index"


# ── Watchers ─────────────────────────────────────────────────────

[watchers]
max_concurrent = 50
min_poll_interval_secs = 30
active_hours = { start = "08:00", end = "23:00" }


# ── Code Integration ────────────────────────────────────────────
# Optional: brew install gh  |  npm i -g @anthropic-ai/claude-code

[code]
claude_code_path = "claude"    # Path to Claude Code CLI binary
gh_path = "gh"                 # Path to GitHub CLI binary
default_workspace = "~/Coding" # Default workspace for code tasks
# Note: spawn_claude_code runs with --dangerously-skip-permissions (daemon mode has no TTY)


# ── Memory / Workspace ──────────────────────────────────────────

[memory]
workspace = "~/.meepo/workspace"

# ── Filesystem Access ────────────────────────────────────────────
# Directories the agent can browse and search.
# The agent can list files, read contents, and search within these dirs.

[filesystem]
allowed_directories = ["~/Coding"]       # Directories the agent can access


# ── Sub-Agent Orchestrator ───────────────────────────────────────

[orchestrator]
max_concurrent_subtasks = 5
max_subtasks_per_request = 10
parallel_timeout_secs = 120
background_timeout_secs = 600
max_background_groups = 3

# ── Autonomous Agent ─────────────────────────────────────────────
# Continuous loop that pursues goals and learns preferences.

[autonomy]
enabled = true
tick_interval_secs = 30       # idle tick rate
max_goals = 50                # prevent runaway goal creation
preference_decay_days = 30    # confidence decay period
min_confidence_to_act = 0.5   # below this, ask user first
max_tokens_per_tick = 4096    # budget per think phase
send_acknowledgments = true   # send typing/ack indicators before processing


# ── Notifications ───────────────────────────────────────────────
# Proactive iMessage (or other channel) alerts throughout the day.
# Meepo will message you when it takes autonomous actions, when
# watchers trigger, when background tasks complete, and more.
#
# Requirements (for iMessage):
#   - iMessage channel must also be enabled above
#   - macOS with Messages app signed into iMessage

[notifications]
enabled = false
channel = "imessage"                    # "imessage", "discord", "slack", "email"
on_task_start = true                    # alert when a background task starts
on_task_complete = true                 # alert when a background task finishes
on_task_fail = true                     # alert when a background task fails
on_watcher_triggered = true             # alert when a watcher fires and agent acts
on_autonomous_action = true             # alert when agent takes proactive action
on_error = true                         # alert on agent errors

# Quiet hours — suppress all notifications except errors
# [notifications.quiet_hours]
# start = "23:00"
# end = "08:00"

# Daily digest — periodic summary iMessages
[notifications.digest]
enabled = false
morning_cron = "0 9 * * *"             # 9am daily — what's ahead today
evening_cron = "0 18 * * *"            # 6pm daily — recap of what happened


# ── MCP Server ──────────────────────────────────────────────────
# Expose Meepo's tools via Model Context Protocol.
# Usage: meepo mcp-server  (STDIO transport for Claude Desktop, Cursor, etc.)
#
# Claude Desktop config (~/.claude/claude_desktop_config.json):
#   { "mcpServers": { "meepo": { "command": "meepo", "args": ["mcp-server"] } } }

[mcp.server]
enabled = true
exposed_tools = []              # empty = all tools (except delegate_tasks)

# ── MCP Clients ─────────────────────────────────────────────────
# Connect to external MCP servers to gain more tools.
# Tools are namespaced: "servername:toolname"
#
# Example — GitHub MCP server:
# [[mcp.clients]]
# name = "github"
# command = "npx"
# args = ["-y", "@modelcontextprotocol/server-github"]
# env = [["GITHUB_TOKEN", "${GITHUB_TOKEN}"]]
#
# Example — Filesystem MCP server:
# [[mcp.clients]]
# name = "filesystem"
# command = "npx"
# args = ["-y", "@modelcontextprotocol/server-filesystem", "/tmp"]


# ── A2A (Agent-to-Agent) ───────────────────────────────────────
# Accept and delegate tasks to/from peer AI agents.
# Protocol: Google's Agent-to-Agent (A2A) over HTTP.

[a2a]
enabled = false
port = 8081
auth_token = "${A2A_AUTH_TOKEN}"
allowed_tools = []              # tools available to incoming A2A tasks

# Known peer agents:
# [[a2a.agents]]
# name = "openclaw"
# url = "http://localhost:3000"
# token = "${OPENCLAW_A2A_TOKEN}"


# ── Skills (OpenClaw compatible) ────────────────────────────────
# Import SKILL.md files as additional tools.
# Each skill lives in its own directory: ~/.meepo/skills/skill_name/SKILL.md

[skills]
enabled = false
dir = "~/.meepo/skills"


# ── Browser Automation (macOS only) ──────────────────────────────
# Control Safari or Chrome via AppleScript.
# Tools: browser_list_tabs, browser_open_tab, browser_close_tab,
#         browser_switch_tab, browser_get_page_content, browser_execute_js,
#         browser_click, browser_fill_form, browser_navigate,
#         browser_get_url, browser_screenshot
#
# Requirements:
#   - macOS with Safari or Google Chrome installed
#   - Safari: Enable "Allow JavaScript from Apple Events" in
#     Safari → Settings → Advanced → check "Show features for web developers"
#     then Develop menu → Allow JavaScript from Apple Events
#   - Chrome: No extra setup needed (AppleScript support built-in)

[browser]
enabled = true
default_browser = "safari"              # "safari" or "chrome"
