# ── Meepo Configuration ──────────────────────────────────────────
# Location: ~/.meepo/config.toml
# Env vars: ${VAR_NAME} expanded at load time  |  Paths: ~/ for home


# ── Agent ────────────────────────────────────────────────────────

[agent]
default_model = "claude-opus-4-6"       # or claude-sonnet-4-5-20250929
max_tokens = 8192
system_prompt_file = "SOUL.md"          # in workspace dir
memory_file = "MEMORY.md"


# ── Anthropic (required) ────────────────────────────────────────
# Get key → https://console.anthropic.com/settings/keys
# export ANTHROPIC_API_KEY="sk-ant-..."

[providers.anthropic]
api_key = "${ANTHROPIC_API_KEY}"
base_url = "https://api.anthropic.com"

# ── OpenAI (optional — failover or primary) ────────────────────
# Get key → https://platform.openai.com/api-keys
# export OPENAI_API_KEY="sk-..."
#
# [providers.openai]
# api_key = "${OPENAI_API_KEY}"
# base_url = "https://api.openai.com"
# model = "gpt-4o"
# max_tokens = 4096

# ── Google Gemini (optional — failover or primary) ─────────────
# Get key → https://aistudio.google.com/apikey
# export GOOGLE_AI_API_KEY="AIza..."
#
# [providers.google]
# api_key = "${GOOGLE_AI_API_KEY}"
# model = "gemini-2.0-flash"
# max_tokens = 4096

# ── OpenAI-Compatible (optional — Ollama, Together, Groq, etc.)
# Any endpoint that speaks the OpenAI /v1/chat/completions format.
#
# [providers.openai_compat]
# name = "ollama"
# api_key = ""
# base_url = "http://localhost:11434/v1"
# model = "llama3"
# max_tokens = 4096

# ── Failover Order ─────────────────────────────────────────────
# When the primary provider fails (rate limit, outage), try the next.
# List provider names: "anthropic", "openai", "google", "openai_compat"
# Empty = no failover (only use the default_model's provider).
#
# failover_order = ["anthropic", "openai", "google"]

# ── Tavily (optional — web search) ──────────────────────────────
# Get key → https://app.tavily.com/home  (free tier, no card)
# export TAVILY_API_KEY="tvly-..."

[providers.tavily]
api_key = "${TAVILY_API_KEY}"


# ── Discord ──────────────────────────────────────────────────────
# 1. https://discord.com/developers/applications → New App → Bot → Reset Token
# 2. Enable MESSAGE CONTENT INTENT
# 3. OAuth2 → scope: bot → Send Messages → invite to server
# export DISCORD_BOT_TOKEN="..."

[channels.discord]
enabled = false
token = "${DISCORD_BOT_TOKEN}"
allowed_users = []                      # e.g. ["123456789012345678"]

# ── Slack ────────────────────────────────────────────────────────
# 1. https://api.slack.com/apps → Create New App → From scratch
# 2. OAuth & Permissions → scopes: chat:write, channels:read, im:history, im:read, users:read
# 3. Install to Workspace → copy Bot User OAuth Token
# export SLACK_BOT_TOKEN="xoxb-..."

[channels.slack]
enabled = false
bot_token = "${SLACK_BOT_TOKEN}"
poll_interval_secs = 3


# ── iMessage Channel (macOS only) ─────────────────────────────────
# Talk to Meepo via iMessage. No API key needed — uses macOS directly.
#
# Requirements:
#   - macOS with Messages app signed into iMessage
#   - Full Disk Access for your terminal app:
#     System Settings → Privacy & Security → Full Disk Access → add Terminal/iTerm
#
# How it works:
#   - Meepo reads ~/Library/Messages/chat.db (read-only) for incoming messages
#   - Processes all messages from allowed contacts
#   - Sends replies via AppleScript through Messages.app
#
# NOTE: This channel is not available on Windows.

[channels.imessage]
enabled = false
poll_interval_secs = 3
trigger_prefix = "/d"
allowed_contacts = []                   # e.g. ["+15551234567", "me@icloud.com"]

# ── Email Channel (macOS only) ──────────────────────────────────
# Talk to Meepo via email through Mail.app. Works with any email
# account configured in Mail.app (Gmail, iCloud, etc.).
#
# How it works:
#   - Meepo polls Mail.app for unread emails with the subject prefix
#   - Only emails whose subject starts with the prefix are processed
#   - Replies are sent as threaded replies to the original email
#
# Requirements:
#   - macOS Mail.app with at least one email account configured
#   - Automation permissions for your terminal app:
#     System Settings → Privacy & Security → Automation → Terminal → Mail
#
# NOTE: This channel is not available on Windows.
# On Windows, use the read_emails/send_email tools which use Outlook via PowerShell.
#
# Example: Send an email with subject "[meepo] What's on my calendar?"

[channels.email]
enabled = false                          # Set to true to enable
poll_interval_secs = 10                  # How often to check for new emails
subject_prefix = "[meepo]"              # Emails must have this subject prefix


# ── Alexa Channel (optional) ─────────────────────────────────────
# Talk to Meepo via Amazon Alexa on any Echo device or Alexa-enabled device.
#
# Setup:
#   1. Go to https://developer.amazon.com/alexa/console/ask
#   2. Create a new Custom Skill → name it "Meepo"
#   3. Set the endpoint to your Meepo instance URL (use ngrok for local dev)
#   4. Copy the Skill ID (starts with amzn1.ask.skill....)
#   5. export ALEXA_SKILL_ID="amzn1.ask.skill...."
#
# How it works:
#   - Alexa sends skill invocation requests to Meepo's HTTP endpoint
#   - Meepo processes the request and returns a spoken response
#   - Works with any Alexa-enabled device linked to your Amazon account

[channels.alexa]
enabled = false
skill_id = "${ALEXA_SKILL_ID}"
poll_interval_secs = 3


# ── Reminders Channel (macOS only) ──────────────────────────────
# Talk to Meepo via Apple Reminders. No API key needed — uses macOS directly.
#
# How it works:
#   - Meepo polls Reminders.app for incomplete reminders in the configured list
#   - New reminders are read as incoming messages, then marked completed
#   - Outgoing messages create new reminders in the same list
#
# Requirements:
#   - macOS with Reminders.app
#   - Automation permissions for your terminal app:
#     System Settings → Privacy & Security → Automation → Terminal → Reminders
#
# Example: Create a reminder in the "Meepo" list → Meepo processes it

[channels.reminders]
enabled = false
poll_interval_secs = 10
list_name = "Meepo"                     # Reminders list to monitor


# ── Notes Channel (macOS only) ──────────────────────────────────
# Talk to Meepo via Apple Notes. No API key needed — uses macOS directly.
#
# How it works:
#   - Meepo polls Notes.app for notes in the configured folder
#   - Only notes whose title starts with the tag prefix are processed
#   - After processing, the tag prefix is removed from the title
#   - Outgoing messages create new notes in the same folder
#
# Requirements:
#   - macOS with Notes.app
#   - Automation permissions for your terminal app:
#     System Settings → Privacy & Security → Automation → Terminal → Notes
#
# Example: Create a note titled "#meepo What's the weather?" in the "Meepo" folder

[channels.notes]
enabled = false
poll_interval_secs = 10
folder_name = "Meepo"                   # Notes folder to monitor
tag_prefix = "#meepo "                  # Notes must start with this to be processed


# ── Contacts Channel (macOS only) ─────────────────────────────────
# Interact with Meepo via Apple Contacts. No API key needed — uses macOS directly.
#
# How it works:
#   - Meepo polls Contacts.app for contacts in the configured group
#   - New contacts in the group are read as incoming messages
#   - After processing, the contact is removed from the group (not deleted)
#   - Outgoing messages create new contacts in the same group
#
# Requirements:
#   - macOS with Contacts.app
#   - Automation permissions for your terminal app:
#     System Settings → Privacy & Security → Automation → Terminal → Contacts
#
# Example: Add a contact to the "Meepo" group → Meepo processes it

[channels.contacts]
enabled = false
poll_interval_secs = 10
group_name = "Meepo"                    # Contacts group to monitor


# ── Knowledge Graph ──────────────────────────────────────────────

[knowledge]
db_path = "~/.meepo/knowledge.db"
tantivy_path = "~/.meepo/tantivy_index"


# ── RAG Features ────────────────────────────────────────────────
# Advanced retrieval-augmented generation capabilities.

# Conversation summarization — automatically summarizes older history
# when approaching context window limits.
[rag.summarization]
enabled = true
trigger_chars = 60000                   # summarize when context exceeds this
keep_recent = 10                        # always keep this many recent messages verbatim

# Query routing — classifies queries and selects retrieval strategy.
[rag.query_router]
enabled = true
use_llm_classification = false          # use heuristics (fast/free) by default

# Tool selection — dynamically selects relevant tools per query.
[rag.tool_selector]
enabled = true
max_tools = 15                          # max tools to pass to the model
activation_threshold = 20               # only activate when this many tools registered

# GraphRAG — relationship-aware retrieval via knowledge graph traversal.
[rag.graph_rag]
max_hops = 2                            # max relationship hops to traverse
max_expanded_results = 20               # max entities after expansion
hop_decay = 0.5                         # score decay per hop

# Corrective RAG — validates retrieval relevance and refines queries.
[rag.corrective]
enabled = false                         # opt-in (adds latency)
max_rounds = 2                          # max correction rounds
relevance_threshold = 0.5               # min ratio of relevant docs

# Vector embeddings — semantic search via local embedding model.
# Requires fastembed-rs (not yet integrated as a dependency).
[rag.embeddings]
enabled = false                         # disabled until fastembed is added
model_name = "sentence-transformers/all-MiniLM-L6-v2"
dimensions = 384
vector_weight = 0.5                     # weight in hybrid search
keyword_weight = 0.5                    # weight in hybrid search

# Document chunking — how documents are split for ingestion.
[rag.chunking]
chunk_size = 1000                       # target chunk size in characters
chunk_overlap = 200                     # overlap between consecutive chunks


# ── Watchers ─────────────────────────────────────────────────────

[watchers]
max_concurrent = 50
min_poll_interval_secs = 30
active_hours = { start = "08:00", end = "23:00" }


# ── Code Integration ────────────────────────────────────────────
# Optional: brew install gh  |  npm i -g @anthropic-ai/claude-code

[code]
claude_code_path = "claude"    # Path to Claude Code CLI binary
gh_path = "gh"                 # Path to GitHub CLI binary
default_workspace = "~/Coding" # Default workspace for code tasks
# Note: spawn_claude_code runs with --dangerously-skip-permissions (daemon mode has no TTY)


# ── Memory / Workspace ──────────────────────────────────────────

[memory]
workspace = "~/.meepo/workspace"

# ── Filesystem Access ────────────────────────────────────────────
# Directories the agent can browse and search.
# The agent can list files, read contents, and search within these dirs.

[filesystem]
allowed_directories = ["~/Coding"]       # Directories the agent can access


# ── Sub-Agent Orchestrator ───────────────────────────────────────

[orchestrator]
max_concurrent_subtasks = 5
max_subtasks_per_request = 10
parallel_timeout_secs = 120
background_timeout_secs = 600
max_background_groups = 3

# ── Autonomous Agent ─────────────────────────────────────────────
# Continuous loop that pursues goals and learns preferences.

[autonomy]
enabled = true
tick_interval_secs = 30       # idle tick rate
max_goals = 50                # prevent runaway goal creation
preference_decay_days = 30    # confidence decay period
min_confidence_to_act = 0.5   # below this, ask user first
max_tokens_per_tick = 4096    # budget per think phase
send_acknowledgments = true   # send typing/ack indicators before processing
daily_plan_hour = 7           # hour (0-23 UTC) to generate daily morning briefing
max_calls_per_minute = 10     # rate limit for autonomous API calls (0 = unlimited)


# ── Notifications ───────────────────────────────────────────────
# Proactive alerts throughout the day via your preferred channel.
# Meepo will message you when it takes autonomous actions, when
# watchers trigger, when background tasks complete, and more.
#
# Requirements (for iMessage — macOS only):
#   - iMessage channel must also be enabled above
#   - macOS with Messages app signed into iMessage
# On Windows: Use "discord" or "slack" as the notification channel.

[notifications]
enabled = false
channel = "imessage"                    # "imessage", "discord", "slack", "email"
on_task_start = true                    # alert when a background task starts
on_task_complete = true                 # alert when a background task finishes
on_task_fail = true                     # alert when a background task fails
on_watcher_triggered = true             # alert when a watcher fires and agent acts
on_autonomous_action = true             # alert when agent takes proactive action
on_error = true                         # alert on agent errors

# Quiet hours — suppress all notifications except errors
# [notifications.quiet_hours]
# start = "23:00"
# end = "08:00"

# Daily digest — periodic summary iMessages
[notifications.digest]
enabled = false
morning_cron = "0 9 * * *"             # 9am daily — what's ahead today
evening_cron = "0 18 * * *"            # 6pm daily — recap of what happened


# ── MCP Server ──────────────────────────────────────────────────
# Expose Meepo's tools via Model Context Protocol.
# Usage: meepo mcp-server  (STDIO transport for Claude Desktop, Cursor, etc.)
#
# Claude Desktop config (~/.claude/claude_desktop_config.json):
#   { "mcpServers": { "meepo": { "command": "meepo", "args": ["mcp-server"] } } }

[mcp.server]
enabled = true
exposed_tools = []              # empty = all tools (except delegate_tasks)

# ── MCP Clients ─────────────────────────────────────────────────
# Connect to external MCP servers to gain more tools.
# Tools are namespaced: "servername:toolname"
#
# Example — GitHub MCP server:
# [[mcp.clients]]
# name = "github"
# command = "npx"
# args = ["-y", "@modelcontextprotocol/server-github"]
# env = [["GITHUB_TOKEN", "${GITHUB_TOKEN}"]]
#
# Example — Filesystem MCP server:
# [[mcp.clients]]
# name = "filesystem"
# command = "npx"
# args = ["-y", "@modelcontextprotocol/server-filesystem", "/tmp"]


# ── A2A (Agent-to-Agent) ───────────────────────────────────────
# Accept and delegate tasks to/from peer AI agents.
# Protocol: Google's Agent-to-Agent (A2A) over HTTP.

[a2a]
enabled = false
port = 8081
auth_token = "${A2A_AUTH_TOKEN}"
allowed_tools = []              # tools available to incoming A2A tasks

# Known peer agents:
# [[a2a.agents]]
# name = "openclaw"
# url = "http://localhost:3000"
# token = "${OPENCLAW_A2A_TOKEN}"


# ── Skills (OpenClaw compatible) ────────────────────────────────
# Import SKILL.md files as additional tools.
# Each skill lives in its own directory: ~/.meepo/skills/skill_name/SKILL.md

[skills]
enabled = false
dir = "~/.meepo/skills"


# ── Usage & Cost Tracking ───────────────────────────────────────
# Track token usage, estimate costs, and enforce budgets.
# All data is stored in the knowledge database (usage_log table).

[usage]
enabled = true
# daily_budget_usd = 10.00            # Hard stop — refuse requests when exceeded
# monthly_budget_usd = 100.00         # Hard stop — refuse requests when exceeded
warn_at_percent = 80                   # Notify user when approaching budget limit

# Model pricing (per million tokens, USD)
# Update these when Anthropic changes pricing.
[usage.model_prices.claude-opus-4-6]
input_per_mtok = 15.0
output_per_mtok = 75.0
cache_read_per_mtok = 1.5
cache_write_per_mtok = 18.75

[usage.model_prices.claude-sonnet-4-5-20250929]
input_per_mtok = 3.0
output_per_mtok = 15.0
cache_read_per_mtok = 0.3
cache_write_per_mtok = 3.75


# ── Lifestyle Integrations ──────────────────────────────────────
# Tools for deep lifestyle automation: email intelligence, calendar,
# research, SMS, tasks, news, finance, health, travel, and social.
# All data is stored in the knowledge graph. Most tools work cross-platform;
# email/calendar/SMS tools require macOS (Mail.app, Calendar.app, Messages.app).

[lifestyle]
# Email Intelligence — triage, draft replies, summarize threads, unsubscribe
[lifestyle.email]
enabled = true
triage_default_hours = 24           # default lookback for email_triage
max_scan_emails = 200               # max emails to scan for unsubscribe

# Smart Calendar — find free time, schedule/reschedule, briefings
[lifestyle.calendar]
enabled = true
working_hours_start = "09:00"
working_hours_end = "17:00"
briefing_include_weather = true

# Deep Research — multi-query research, reports, topic tracking, fact-check
[lifestyle.research]
enabled = true
default_depth = "standard"          # quick, standard, deep
max_sources = 25

# SMS/iMessage Autopilot — send texts, auto-reply, message summaries
[lifestyle.sms]
enabled = true
auto_reply_default_duration = 60    # minutes

# Task & Project Manager — GTD-style task system in knowledge graph
[lifestyle.tasks]
enabled = true
default_priority = "medium"         # critical, high, medium, low

# News & Content Curator — track feeds, summarize articles, digests
[lifestyle.news]
enabled = true
default_check_interval_hours = 12
max_items_per_feed = 10

# Finance & Expense Tracker — log expenses, budgets, receipt parsing
[lifestyle.finance]
enabled = true
default_currency = "USD"

# Health & Habit Tracker — log habits, streaks, reports
[lifestyle.health]
enabled = true

# Travel & Commute Assistant — weather, directions, flights, packing
[lifestyle.travel]
enabled = true

# Social & Relationship Manager — relationship tracking, follow-ups
[lifestyle.social]
enabled = true
inactive_days_threshold = 30        # flag contacts not reached in N days


# ── Browser Automation (macOS only — not yet available on Windows) ─
# Control Safari or Chrome via AppleScript.
# Tools: browser_list_tabs, browser_open_tab, browser_close_tab,
#         browser_switch_tab, browser_get_page_content, browser_execute_js,
#         browser_click, browser_fill_form, browser_navigate,
#         browser_get_url, browser_screenshot
#
# Requirements:
#   - macOS with Safari or Google Chrome installed
#   - Safari: Enable "Allow JavaScript from Apple Events" in
#     Safari → Settings → Advanced → check "Show features for web developers"
#     then Develop menu → Allow JavaScript from Apple Events
#   - Chrome: No extra setup needed (AppleScript support built-in)
#
# Windows: Browser automation is not yet implemented. This section
# is ignored on Windows.

[browser]
enabled = true
default_browser = "safari"              # "safari" or "chrome"


# ── Gateway (WebSocket Control Plane) ──────────────────────────
# Run a WebSocket server so clients (WebChat, macOS app, mobile nodes)
# can connect to Meepo remotely. The Gateway is the foundation for
# multi-device access, WebChat UI, and companion apps.
#
# When enabled, the Gateway starts alongside the daemon on `meepo start`.
# Clients connect via ws://<bind>:<port>/ws with bearer token auth.
#
# export MEEPO_GATEWAY_TOKEN="your-secret-token"

[gateway]
enabled = false
bind = "127.0.0.1"                      # Use 0.0.0.0 for remote access
port = 18789
auth_token = "${MEEPO_GATEWAY_TOKEN}"

# ── Voice / Talk Mode ─────────────────────────────────────────────
# Speech-to-text (STT) and text-to-speech (TTS) for hands-free interaction.
# Use `meepo talk` to enter continuous voice conversation mode.
#
# STT providers: whisper_api (OpenAI Whisper), whisper_local (local whisper.cpp)
# TTS providers: macos_say (macOS built-in), elevenlabs, openai_tts
#
# export ELEVENLABS_API_KEY="your-elevenlabs-key"

[voice]
enabled = false
stt_provider = "whisper_api"            # whisper_api | whisper_local
tts_provider = "macos_say"             # macos_say | elevenlabs | openai_tts
elevenlabs_api_key = "${ELEVENLABS_API_KEY}"
elevenlabs_voice_id = "default"
wake_word = "hey meepo"
wake_enabled = false
