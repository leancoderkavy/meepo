# ── Meepo Configuration ──────────────────────────────────────────
# Location: ~/.meepo/config.toml
# Env vars: ${VAR_NAME} expanded at load time  |  Paths: ~/ for home


# ── Agent ────────────────────────────────────────────────────────

[agent]
default_model = "claude-opus-4-6"       # or claude-sonnet-4-5-20250929
max_tokens = 8192
system_prompt_file = "SOUL.md"          # in workspace dir
memory_file = "MEMORY.md"


# ── Anthropic (required) ────────────────────────────────────────
# Get key → https://console.anthropic.com/settings/keys
# export ANTHROPIC_API_KEY="sk-ant-..."

[providers.anthropic]
api_key = "${ANTHROPIC_API_KEY}"
base_url = "https://api.anthropic.com"

# ── Tavily (optional — web search) ──────────────────────────────
# Get key → https://app.tavily.com/home  (free tier, no card)
# export TAVILY_API_KEY="tvly-..."

[providers.tavily]
api_key = "${TAVILY_API_KEY}"


# ── Discord ──────────────────────────────────────────────────────
# 1. https://discord.com/developers/applications → New App → Bot → Reset Token
# 2. Enable MESSAGE CONTENT INTENT
# 3. OAuth2 → scope: bot → Send Messages → invite to server
# export DISCORD_BOT_TOKEN="..."

[channels.discord]
enabled = false
token = "${DISCORD_BOT_TOKEN}"
allowed_users = []                      # e.g. ["123456789012345678"]

# ── Slack ────────────────────────────────────────────────────────
# 1. https://api.slack.com/apps → Create New App → From scratch
# 2. OAuth & Permissions → scopes: chat:write, channels:read, im:history, im:read, users:read
# 3. Install to Workspace → copy Bot User OAuth Token
# export SLACK_BOT_TOKEN="xoxb-..."

[channels.slack]
enabled = false
bot_token = "${SLACK_BOT_TOKEN}"
poll_interval_secs = 3

# ── iMessage (macOS only) ────────────────────────────────────────
# No API key needed — uses macOS Messages.app directly.
# Requires: Full Disk Access for your terminal app.
#   System Settings → Privacy & Security → Full Disk Access → toggle ON
# Messages starting with trigger_prefix are processed; replies via AppleScript.
# NOTE: This channel is not available on Windows.

[channels.imessage]
enabled = false
poll_interval_secs = 3
trigger_prefix = "/d"
allowed_contacts = []                   # e.g. ["+15551234567", "me@icloud.com"]

# ── Email Channel (macOS only) ──────────────────────────────────
# Talk to Meepo via email through Mail.app. Works with any email
# account configured in Mail.app (Gmail, iCloud, etc.).
#
# How it works:
#   - Meepo polls Mail.app for unread emails with the subject prefix
#   - Only emails whose subject starts with the prefix are processed
#   - Replies are sent as threaded replies to the original email
#
# Requirements:
#   - macOS Mail.app with at least one email account configured
#   - Automation permissions for your terminal app:
#     System Settings → Privacy & Security → Automation → Terminal → Mail
#
# NOTE: This channel is not available on Windows.
# On Windows, use the read_emails/send_email tools which use Outlook via PowerShell.
#
# Example: Send an email with subject "[meepo] What's on my calendar?"

[channels.email]
enabled = false                          # Set to true to enable
poll_interval_secs = 10                  # How often to check for new emails
subject_prefix = "[meepo]"              # Emails must have this subject prefix


# ── Knowledge Graph ──────────────────────────────────────────────

[knowledge]
db_path = "~/.meepo/knowledge.db"
tantivy_path = "~/.meepo/tantivy_index"


# ── Watchers ─────────────────────────────────────────────────────

[watchers]
max_concurrent = 50
min_poll_interval_secs = 30
active_hours = { start = "08:00", end = "23:00" }


# ── Code Integration ────────────────────────────────────────────
# Optional: brew install gh  |  npm i -g @anthropic-ai/claude-code

[code]
claude_code_path = "claude"
gh_path = "gh"
default_workspace = "~/Coding"


# ── Memory / Workspace ──────────────────────────────────────────

[memory]
workspace = "~/.meepo/workspace"

# ── Filesystem Access ────────────────────────────────────────────
# Directories the agent can browse and search.
# The agent can list files, read contents, and search within these dirs.

[filesystem]
allowed_directories = ["~/Coding"]       # Directories the agent can access


# ── Sub-Agent Orchestrator ───────────────────────────────────────

[orchestrator]
max_concurrent_subtasks = 5
max_subtasks_per_request = 10
parallel_timeout_secs = 120
background_timeout_secs = 600
max_background_groups = 3

# ── Autonomous Agent ─────────────────────────────────────────────
# Continuous loop that pursues goals and learns preferences.

[autonomy]
enabled = true
tick_interval_secs = 30       # idle tick rate
max_goals = 50                # prevent runaway goal creation
preference_decay_days = 30    # confidence decay period
min_confidence_to_act = 0.5   # below this, ask user first
max_tokens_per_tick = 4096    # budget per think phase
