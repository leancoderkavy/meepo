# ╔══════════════════════════════════════════════════════════════════╗
# ║                    Meepo Configuration                         ║
# ║                                                                ║
# ║  Location: ~/.meepo/config.toml                                ║
# ║  Env vars: Use ${VAR_NAME} syntax (expanded at load time)      ║
# ║  Paths:    Use ~/ for home directory expansion                  ║
# ╚══════════════════════════════════════════════════════════════════╝


# ── Agent Settings ────────────────────────────────────────────────
# Controls which Claude model to use and response limits.

[agent]
default_model = "claude-opus-4-6"       # Options: claude-opus-4-6, claude-sonnet-4-5-20250929
max_tokens = 8192                        # Max tokens per response (higher = longer responses)
system_prompt_file = "SOUL.md"           # Agent personality file (in workspace dir)
memory_file = "MEMORY.md"               # Persistent memory file (in workspace dir)


# ── API Provider ──────────────────────────────────────────────────
# REQUIRED: Your Anthropic API key. Everything needs this.
#
# Get your key at: https://console.anthropic.com/settings/keys
#   1. Sign up / log in at console.anthropic.com
#   2. Go to Settings → API Keys
#   3. Click "Create Key"
#   4. Copy the key (starts with sk-ant-)
#
# Set it as an environment variable (recommended):
#   export ANTHROPIC_API_KEY="sk-ant-..."
#
# Or paste it directly below (not recommended — keeps secrets out of files):
#   api_key = "sk-ant-..."

[providers.anthropic]
api_key = "${ANTHROPIC_API_KEY}"
base_url = "https://api.anthropic.com"


# ── Discord Channel ───────────────────────────────────────────────
# Talk to Meepo via Discord DMs. Requires a Discord bot.
#
# Setup:
#   1. Go to https://discord.com/developers/applications
#   2. Click "New Application" → name it "Meepo"
#   3. Go to Bot → click "Reset Token" → copy the token
#   4. Enable these Privileged Gateway Intents:
#      ✓ MESSAGE CONTENT INTENT
#      ✓ (DIRECT MESSAGES is on by default)
#   5. Go to OAuth2 → URL Generator:
#      - Scopes: bot
#      - Bot Permissions: Send Messages, Read Message History
#      - Copy the URL and open it to invite the bot to your server
#   6. Get your Discord user ID:
#      - Enable Developer Mode: User Settings → Advanced → Developer Mode
#      - Right-click your name → "Copy User ID"
#
# Set the token as an environment variable:
#   export DISCORD_BOT_TOKEN="your-token-here"

[channels.discord]
enabled = false                          # Set to true to enable
token = "${DISCORD_BOT_TOKEN}"           # Bot token from step 3
allowed_users = []                       # Your Discord user ID(s), e.g. ["123456789012345678"]


# ── Slack Channel ─────────────────────────────────────────────────
# Talk to Meepo via Slack DMs. Uses polling (no Socket Mode needed).
#
# Setup:
#   1. Go to https://api.slack.com/apps
#   2. Click "Create New App" → "From scratch"
#   3. Go to OAuth & Permissions → add these Bot Token Scopes:
#      - chat:write
#      - channels:read
#      - im:history
#      - im:read
#      - users:read
#   4. Click "Install to Workspace" → authorize
#   5. Copy the "Bot User OAuth Token" (starts with xoxb-)
#
# Set the token as an environment variable:
#   export SLACK_BOT_TOKEN="xoxb-..."

[channels.slack]
enabled = false                          # Set to true to enable
app_token = "${SLACK_APP_TOKEN}"         # Optional (not needed for polling mode)
bot_token = "${SLACK_BOT_TOKEN}"         # Bot token from step 5
poll_interval_secs = 3                   # How often to check for new messages (seconds)


# ── iMessage Channel ──────────────────────────────────────────────
# Talk to Meepo via iMessage. No API key needed — uses macOS directly.
#
# Requirements:
#   - macOS with Messages app signed into iMessage
#   - Full Disk Access for your terminal app:
#     System Settings → Privacy & Security → Full Disk Access → add Terminal/iTerm
#
# How it works:
#   - Meepo reads ~/Library/Messages/chat.db (read-only) for incoming messages
#   - Only processes messages starting with the trigger prefix (default: /d)
#   - Sends replies via AppleScript through Messages.app
#
# Example: Text "/d What's on my calendar?" to get a response.

[channels.imessage]
enabled = false                          # Set to true to enable
poll_interval_secs = 3                   # How often to check for new messages
trigger_prefix = "/d"                    # Messages must start with this to be processed
allowed_contacts = []                    # Phone numbers or emails, e.g. ["+15551234567", "me@icloud.com"]


# ── Knowledge Graph ───────────────────────────────────────────────
# Persistent storage for entities, relationships, and conversations.
# These are created automatically — no setup needed.

[knowledge]
db_path = "~/.meepo/knowledge.db"        # SQLite database
tantivy_path = "~/.meepo/tantivy_index"  # Full-text search index


# ── Watchers ──────────────────────────────────────────────────────
# Background monitors for email, calendar, GitHub, files, and cron tasks.

[watchers]
max_concurrent = 50                      # Max watchers running at once
min_poll_interval_secs = 30              # Minimum polling interval (prevents API spam)
active_hours = { start = "08:00", end = "23:00" }  # Only run during these hours (24h format)


# ── Code Integration ──────────────────────────────────────────────
# Tools for writing code and managing PRs. Requires claude and gh CLIs.
#
# Install if needed:
#   brew install gh           # GitHub CLI
#   npm install -g @anthropic-ai/claude-code  # Claude CLI

[code]
claude_code_path = "claude"              # Path to Claude Code CLI binary
gh_path = "gh"                           # Path to GitHub CLI binary
default_workspace = "~/Coding"           # Default directory for code operations


# ── Memory / Workspace ────────────────────────────────────────────
# Where SOUL.md and MEMORY.md live. Created by `meepo init`.

[memory]
workspace = "~/.meepo/workspace"


# =============================================================================
# Sub-Agent Orchestrator
# =============================================================================
[orchestrator]
# Maximum sub-tasks running concurrently within a single delegation
max_concurrent_subtasks = 5
# Maximum total sub-tasks per single delegate_tasks call
max_subtasks_per_request = 10
# Timeout per sub-task in parallel mode (seconds)
parallel_timeout_secs = 120
# Timeout per sub-task in background mode (seconds)
background_timeout_secs = 600
# Maximum background task groups running simultaneously
max_background_groups = 3
